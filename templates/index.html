<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hybrid Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="app">
    <header>
        <h1>ü§ñ Hybrid Intelligence Chatbot</h1>
    </header>

    <div id="chat-box"></div>

    <div class="input-area">
        <input 
            id="user-input" 
            type="text" 
            placeholder="Ask anything..." 
            onkeydown="handleEnter(event)"
        />
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
function handleEnter(event) {
    if (event.key === "Enter") {
        sendMessage();
    }
}

async function sendMessage() {
    const input = document.getElementById("user-input");
    const chatBox = document.getElementById("chat-box");
    const message = input.value.trim();

    if (!message) return;

    chatBox.innerHTML += `
        <div class="message user">
            <div class="bubble">${message}</div>
        </div>
    `;
    input.value = "";
    chatBox.scrollTop = chatBox.scrollHeight;

    // Typing indicator
    const typingId = "typing-" + Date.now();
    chatBox.innerHTML += `
        <div class="message bot" id="${typingId}">
            <div class="bubble">ü§ñ Thinking...</div>
        </div>
    `;
    chatBox.scrollTop = chatBox.scrollHeight;

    try {
        const response = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question: message })
        });

        const data = await response.json();
        document.getElementById(typingId).remove();

        chatBox.innerHTML += `
            <div class="message bot">
                <div class="bubble">${data.answer}</div>
            </div>
        `;
    } catch (error) {
        document.getElementById(typingId).remove();
        chatBox.innerHTML += `
            <div class="message bot">
                <div class="bubble">‚ö†Ô∏è Server error. Try again.</div>
            </div>
        `;
    }

    chatBox.scrollTop = chatBox.scrollHeight;
}
</script>

</body>
</html>
